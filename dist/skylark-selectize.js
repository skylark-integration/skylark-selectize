/**
 * skylark-selectize - A version of jquery.appendgrid that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-selectize/
 * @license MIT
 */
!function(t,e){var i=e.define,require=e.require,s="function"==typeof i&&i.amd,n=!s&&"undefined"!=typeof exports;if(!s&&!i){var o={};i=e.define=function(t,e,i){"function"==typeof i?(o[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),s=t.split("/");i.pop();for(var n=0;n<s.length;n++)"."!=s[n]&&(".."==s[n]?i.pop():i.push(s[n]));return i.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):o[t]={factory:null,resolved:!0,exports:i}},require=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=o[t];if(!module.resolved){var i=[];module.deps.forEach(function(t){i.push(require(t))}),module.exports=module.factory.apply(e,i)||null,module.resolved=!0}return module.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-selectize/constants",[],function(){var t=/Mac/.test(navigator.userAgent),e=t?91:17,i=t?18:17,s=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity;return{IS_MAC:t,KEY_A:65,KEY_COMMA:188,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_P:80,KEY_RIGHT:39,KEY_DOWN:40,KEY_N:78,KEY_BACKSPACE:8,KEY_DELETE:46,KEY_SHIFT:16,KEY_CMD:e,KEY_CTRL:i,KEY_TAB:9,TAG_SELECT:1,TAG_INPUT:2,SUPPORTS_VALIDITY_API:s}}),t("skylark-selectize/utils",["skylark-jquery","./constants"],function(t,e){var i,s={before:function(t,e,i){var s=t[e];t[e]=function(){return i.apply(t,arguments),s.apply(t,arguments)}},after:function(t,e,i){var s=t[e];t[e]=function(){var e=s.apply(t,arguments);return i.apply(t,arguments),e}}},n=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var i=document.selection.createRange(),s=document.selection.createRange().text.length;i.moveStart("character",-t.value.length),e.start=i.text.length-s,e.length=s}return e},o=function(t,e,i){var s,n,o={};if(i)for(s=0,n=i.length;s<n;s++)o[i[s]]=t.css(i[s]);else o=t.css();e.css(o)},r=function(e,s){return e?(i||(i=t("<span />").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).appendTo("body")),i.text(e),o(s,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),i.width()):0};return{isset:function(t){return void 0!==t},hash_key:function(t){return void 0===t||null===t?null:"boolean"==typeof t?t?"1":"0":t+""},escape_html:function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},escape_replace:function(t){return(t+"").replace(/\$/g,"$$$$")},hook:s,once:function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},debounce:function(t,e){var i;return function(){var s=this,n=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(s,n)},e)}},debounce_events:function(t,e,i){var s,n=t.trigger,o={};for(s in t.trigger=function(){var i=arguments[0];if(-1===e.indexOf(i))return n.apply(t,arguments);o[i]=arguments},i.apply(t,[]),t.trigger=n,o)o.hasOwnProperty(s)&&n.apply(t,o[s])},watchChildEvent:function(t,e,i,s){t.on(e,i,function(e){for(var i=e.target;i&&i.parentNode!==t[0];)i=i.parentNode;return e.currentTarget=i,s.apply(this,[e])})},getSelection:n,transferStyles:o,measureString:r,autoGrow:function(t){var i=null,s=function(s,o){var a,l,h,p,u,c,d,g;s=s||window.event||{},o=o||{},s.metaKey||s.altKey||(o.force||!1!==t.data("grow"))&&(a=t.val(),s.type&&"keydown"===s.type.toLowerCase()&&(l=s.keyCode,h=l>=48&&l<=57||l>=65&&l<=90||l>=96&&l<=111||l>=186&&l<=222||32===l,l===e.KEY_DELETE||l===e.KEY_BACKSPACE?(g=n(t[0])).length?a=a.substring(0,g.start)+a.substring(g.start+g.length):l===e.KEY_BACKSPACE&&g.start?a=a.substring(0,g.start-1)+a.substring(g.start+1):l===e.KEY_DELETE&&void 0!==g.start&&(a=a.substring(0,g.start)+a.substring(g.start+1)):h&&(c=s.shiftKey,d=String.fromCharCode(s.keyCode),d=c?d.toUpperCase():d.toLowerCase(),a+=d)),p=t.attr("placeholder"),!a&&p&&(a=p),(u=r(a,t)+4)!==i&&(i=u,t.width(u),t.triggerHandler("resize")))};t.on("keydown keyup update blur",s),s()},domToString:function(t){var e=document.createElement("div");return e.appendChild(t.cloneNode(!0)),e.innerHTML},logError:function(t,e){e||(e={});console.error("Selectize: "+t),e.explanation&&(console.group&&console.group(),console.error(e.explanation),console.group&&console.groupEnd())}}}),t("skylark-selectize/Sifter",["skylark-langx/langx"],function(t){var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:t<e?-1:0:(t=n(String(t||"")),e=n(String(e||"")),t>e?1:e>t?-1:0)},i=function(t,e,i){if(t&&e){if(!i)return t[e];for(var s=e.split(".");s.length&&(t=t[s.shift()]););return t}},s={a:"[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]",b:"[b␢βΒB฿𐌁ᛒ]",c:"[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]",d:"[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]",e:"[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]",f:"[fƑƒḞḟ]",g:"[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]",h:"[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]",i:"[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]",j:"[jȷĴĵɈɉʝɟʲ]",k:"[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]",l:"[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]",n:"[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]",o:"[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]",p:"[pṔṕṖṗⱣᵽƤƥᵱ]",q:"[qꝖꝗʠɊɋꝘꝙq̃]",r:"[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]",s:"[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]",t:"[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]",u:"[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]",v:"[vṼṽṾṿƲʋꝞꝟⱱʋ]",w:"[wẂẃẀẁŴŵẄẅẆẇẈẉ]",x:"[xẌẍẊẋχ]",y:"[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]",z:"[zŹźẐẑŽžŻżẒẓẔẕƵƶ]"},n=function(){var t,e,i,n,o="",r={};for(i in s)if(s.hasOwnProperty(i))for(n=s[i].substring(2,s[i].length-1),o+=n,t=0,e=n.length;t<e;t++)r[n.charAt(t)]=i;var a=new RegExp("["+o+"]","g");return function(t){return t.replace(a,function(t){return r[t]}).toLowerCase()}}(),o=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};return o.prototype.tokenize=function(e){if(!(e=t.trim(String(e||"").toLowerCase()))||!e.length)return[];var i,n,o,r,a,l=[],h=e.split(/ +/);for(i=0,n=h.length;i<n;i++){if(a=h[i],o=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),this.settings.diacritics)for(r in s)s.hasOwnProperty(r)&&(o=o.replace(new RegExp(r,"g"),s[r]));l.push({string:h[i],regex:new RegExp(o,"i")})}return l},o.prototype.iterator=function(e,i){(t.isArray(e)?Array.prototype.forEach||function(t){for(var e=0,i=this.length;e<i;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)}).apply(e,[i])},o.prototype.getScoreFunction=function(t,e){var s,n,o,r;t=this.prepareSearch(t,e),n=t.tokens,s=t.options.fields,o=n.length,r=t.options.nesting;var a,l=function(t,e){var i,s;return t?(t=String(t||""),-1===(s=t.search(e.regex))?0:(i=e.string.length/t.length,0===s&&(i+=.5),i)):0},h=(a=s.length)?1===a?function(t,e){return l(i(e,s[0],r),t)}:function(t,e){for(var n=0,o=0;n<a;n++)o+=l(i(e,s[n],r),t);return o/a}:function(){return 0};return o?1===o?function(t){return h(n[0],t)}:"and"===t.options.conjunction?function(t){for(var e,i=0,s=0;i<o;i++){if((e=h(n[i],t))<=0)return 0;s+=e}return s/o}:function(t){for(var e=0,i=0;e<o;e++)i+=h(n[e],t);return i/o}:function(){return 0}},o.prototype.getSortFunction=function(t,s){var n,o,r,a,l,h,p,u,c,d,g;if(t=(r=this).prepareSearch(t,s),g=!t.query&&s.sort_empty||s.sort,c=function(t,e){return"$score"===t?e.score:i(r.items[e.id],t,s.nesting)},l=[],g)for(n=0,o=g.length;n<o;n++)(t.query||"$score"!==g[n].field)&&l.push(g[n]);if(t.query){for(d=!0,n=0,o=l.length;n<o;n++)if("$score"===l[n].field){d=!1;break}d&&l.unshift({field:"$score",direction:"desc"})}else for(n=0,o=l.length;n<o;n++)if("$score"===l[n].field){l.splice(n,1);break}for(u=[],n=0,o=l.length;n<o;n++)u.push("desc"===l[n].direction?-1:1);return(h=l.length)?1===h?(a=l[0].field,p=u[0],function(t,i){return p*e(c(a,t),c(a,i))}):function(t,i){var s,n,o;for(s=0;s<h;s++)if(o=l[s].field,n=u[s]*e(c(o,t),c(o,i)))return n;return 0}:null},o.prototype.prepareSearch=function(e,i){if("object"==typeof e)return e;var s=(i=t.extend({},i)).fields,n=i.sort,o=i.sort_empty;return s&&!t.isArray(s)&&(i.fields=[s]),n&&!t.isArray(n)&&(i.sort=[n]),o&&!t.isArray(o)&&(i.sort_empty=[o]),{options:i,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}},o.prototype.search=function(t,e){var i,s,n,o;return s=this.prepareSearch(t,e),e=s.options,t=s.query,o=e.score||this.getScoreFunction(s),t.length?this.iterator(this.items,function(t,n){i=o(t),(!1===e.filter||i>0)&&s.items.push({score:i,id:n})}):this.iterator(this.items,function(t,e){s.items.push({score:1,id:e})}),(n=this.getSortFunction(s,e))&&s.items.sort(n),s.total=s.items.length,"number"==typeof e.limit&&(s.items=s.items.slice(0,e.limit)),s},o}),t("skylark-selectize/contrib/MicroPlugin",[],function(){var t={mixin:function(t){t.plugins={},t.prototype.initializePlugins=function(t){var e,i,s,n=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},Array.isArray(t))for(e=0,i=t.length;e<i;e++)"string"==typeof t[e]?n.push(t[e]):(this.plugins.settings[t[e].name]=t[e].options,n.push(t[e].name));else if(t)for(s in t)t.hasOwnProperty(s)&&(this.plugins.settings[s]=t[s],n.push(s));for(;n.length;)this.require(n.shift())},t.prototype.loadPlugin=function(e){var i=this.plugins,s=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=s.fn.apply(this,[this.plugins.settings[e]||{}]),i.names.push(e)},t.prototype.require=function(t){var e=this.plugins;if(!this.plugins.loaded.hasOwnProperty(t)){if(e.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');this.loadPlugin(t)}return e.loaded[t]},t.define=function(e,i){t.plugins[e]={name:e,fn:i}}}};return t}),t("skylark-selectize/contrib/microevent",[],function(){var t=function(){};return t.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},t.mixin=function(e){for(var i=["on","off","trigger"],s=0;s<i.length;s++)e.prototype[i[s]]=t.prototype[i[s]]},t}),t("skylark-selectize/contrib/highlight",["skylark-jquery"],function(t){return t.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()}).end()},function(t,e){if("string"==typeof e&&!e.length)return;var i="string"==typeof e?new RegExp(e,"i"):e,s=function(t){var e=0;if(3===t.nodeType){var n=t.data.search(i);if(n>=0&&t.data.length>0){var o=t.data.match(i),r=document.createElement("span");r.className="highlight";var a=t.splitText(n),l=(a.splitText(o[0].length),a.cloneNode(!0));r.appendChild(l),a.parentNode.replaceChild(r,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&("highlight"!==t.className||"SPAN"!==t.tagName))for(var h=0;h<t.childNodes.length;++h)h+=s(t.childNodes[h]);return e};return t.each(function(){s(this)})}}),t("skylark-selectize/Selectize",["skylark-langx/skylark","skylark-jquery","./constants","./utils","./Sifter","./contrib/MicroPlugin","./contrib/microevent","./contrib/highlight"],function(t,e,i,s,n,o,r,a){var l=function(t,o){var r,a,h,p;(p=t[0]).selectize=this;var u=window.getComputedStyle&&window.getComputedStyle(p,null);if(h=(h=u?u.getPropertyValue("direction"):p.currentStyle&&p.currentStyle.direction)||t.parents("[dir]:first").attr("dir")||"",e.extend(this,{order:0,settings:o,$input:t,tabIndex:t.attr("tabindex")||"",tagType:"select"===p.tagName.toLowerCase()?i.TAG_SELECT:i.TAG_INPUT,rtl:/rtl/i.test(h),eventNS:".selectize"+ ++l.count,highlightedValue:null,isBlurring:!1,isOpen:!1,isDisabled:!1,isRequired:t.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===o.loadThrottle?this.onSearchChange:s.debounce(this.onSearchChange,o.loadThrottle)}),this.sifter=new n(this.options,{diacritics:o.diacritics}),this.settings.options){for(r=0,a=this.settings.options.length;r<a;r++)this.registerOption(this.settings.options[r]);delete this.settings.options}if(this.settings.optgroups){for(r=0,a=this.settings.optgroups.length;r<a;r++)this.registerOptionGroup(this.settings.optgroups[r]);delete this.settings.optgroups}this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi"),"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode),this.initializePlugins(this.settings.plugins),this.setupCallbacks(),this.setupTemplates(),this.setup()};return r.mixin(l),o.mixin(l),e.extend(l.prototype,{setup:function(){var t,n,o,r,a,l,h,p,u,c,d=this,g=d.settings,f=d.eventNS,v=e(window),m=e(document),y=d.$input;if(h=d.settings.mode,p=y.attr("class")||"",t=e("<div>").addClass(g.wrapperClass).addClass(p).addClass(h),n=e("<div>").addClass(g.inputClass).addClass("items").appendTo(t),o=e('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",y.is(":disabled")?"-1":d.tabIndex),l=e(g.dropdownParent||t),r=e("<div>").addClass(g.dropdownClass).addClass(h).hide().appendTo(l),a=e("<div>").addClass(g.dropdownContentClass).appendTo(r),(c=y.attr("id"))&&(o.attr("id",c+"-selectized"),e("label[for='"+c+"']").attr("for",c+"-selectized")),d.settings.copyClassesToDropdown&&r.addClass(p),t.css({width:y[0].style.width}),d.plugins.names.length&&(u="plugin-"+d.plugins.names.join(" plugin-"),t.addClass(u),r.addClass(u)),(null===g.maxItems||g.maxItems>1)&&d.tagType===i.TAG_SELECT&&y.attr("multiple","multiple"),d.settings.placeholder&&o.attr("placeholder",g.placeholder),!d.settings.splitOn&&d.settings.delimiter){var w=d.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");d.settings.splitOn=new RegExp("\\s*"+w+"+\\s*")}y.attr("autocorrect")&&o.attr("autocorrect",y.attr("autocorrect")),y.attr("autocapitalize")&&o.attr("autocapitalize",y.attr("autocapitalize")),o[0].type=y[0].type,d.$wrapper=t,d.$control=n,d.$control_input=o,d.$dropdown=r,d.$dropdown_content=a,r.on("mouseenter mousedown click","[data-disabled]>[data-selectable]",function(t){t.stopImmediatePropagation()}),r.on("mouseenter","[data-selectable]",function(){return d.onOptionHover.apply(d,arguments)}),r.on("mousedown click","[data-selectable]",function(){return d.onOptionSelect.apply(d,arguments)}),s.watchChildEvent(n,"mousedown","*:not(input)",function(){return d.onItemSelect.apply(d,arguments)}),s.autoGrow(o),n.on({mousedown:function(){return d.onMouseDown.apply(d,arguments)},click:function(){return d.onClick.apply(d,arguments)}}),o.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return d.onKeyDown.apply(d,arguments)},keyup:function(){return d.onKeyUp.apply(d,arguments)},keypress:function(){return d.onKeyPress.apply(d,arguments)},resize:function(){d.positionDropdown.apply(d,[])},blur:function(){return d.onBlur.apply(d,arguments)},focus:function(){return d.ignoreBlur=!1,d.onFocus.apply(d,arguments)},paste:function(){return d.onPaste.apply(d,arguments)}}),m.on("keydown"+f,function(t){d.isCmdDown=t[i.IS_MAC?"metaKey":"ctrlKey"],d.isCtrlDown=t[i.IS_MAC?"altKey":"ctrlKey"],d.isShiftDown=t.shiftKey}),m.on("keyup"+f,function(t){t.keyCode===i.KEY_CTRL&&(d.isCtrlDown=!1),t.keyCode===i.KEY_SHIFT&&(d.isShiftDown=!1),t.keyCode===i.KEY_CMD&&(d.isCmdDown=!1)}),m.on("mousedown"+f,function(t){if(d.isFocused){if(t.target===d.$dropdown[0]||t.target.parentNode===d.$dropdown[0])return!1;d.$control.has(t.target).length||t.target===d.$control[0]||d.blur(t.target)}}),v.on(["scroll"+f,"resize"+f].join(" "),function(){d.isOpen&&d.positionDropdown.apply(d,arguments)}),v.on("mousemove"+f,function(){d.ignoreHover=!1}),this.revertSettings={$children:y.children().detach(),tabindex:y.attr("tabindex")},y.attr("tabindex",-1).hide().after(d.$wrapper),e.isArray(g.items)&&(d.setValue(g.items),delete g.items),i.SUPPORTS_VALIDITY_API&&y.on("invalid"+f,function(t){t.preventDefault(),d.isInvalid=!0,d.refreshState()}),d.updateOriginalInput(),d.refreshItems(),d.refreshState(),d.updatePlaceholder(),d.isSetup=!0,y.is(":disabled")&&d.disable(),d.on("change",this.onChange),y.data("selectize",d),y.addClass("selectized"),d.trigger("initialize"),!0===g.preload&&d.onSearchChange("")},setupTemplates:function(){var t=this.settings.labelField,i=this.settings.optgroupLabelField,s={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(e,i){return'<div class="option">'+i(e[t])+"</div>"},item:function(e,i){return'<div class="item">'+i(e[t])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};this.settings.render=e.extend({},s,this.settings.render)},setupCallbacks:function(){var t,e,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(t in i)i.hasOwnProperty(t)&&(e=this.settings[i[t]])&&this.on(t,e)},onClick:function(t){this.isFocused&&this.isOpen||(this.focus(),t.preventDefault())},onMouseDown:function(t){var i=this,s=t.isDefaultPrevented();e(t.target);if(i.isFocused){if(t.target!==i.$control_input[0])return"single"===i.settings.mode?i.isOpen?i.close():i.open():s||i.setActiveItem(null),!1}else s||window.setTimeout(function(){i.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var i=this;i.isFull()||i.isInputHidden||i.isLocked?t.preventDefault():i.settings.splitOn&&setTimeout(function(){var t=i.$control_input.val();if(t.match(i.settings.splitOn))for(var s=e.trim(t).split(i.settings.splitOn),n=0,o=s.length;n<o;n++)i.createItem(s[n])},0)},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&"multi"===this.settings.mode&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){t.target,this.$control_input[0];if(this.isLocked)t.keyCode!==i.KEY_TAB&&t.preventDefault();else{switch(t.keyCode){case i.KEY_A:if(this.isCmdDown)return void this.selectAll();break;case i.KEY_ESC:return void(this.isOpen&&(t.preventDefault(),t.stopPropagation(),this.close()));case i.KEY_N:if(!t.ctrlKey||t.altKey)break;case i.KEY_DOWN:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=!0;var e=this.getAdjacentOption(this.$activeOption,1);e.length&&this.setActiveOption(e,!0,!0)}return void t.preventDefault();case i.KEY_P:if(!t.ctrlKey||t.altKey)break;case i.KEY_UP:if(this.$activeOption){this.ignoreHover=!0;var s=this.getAdjacentOption(this.$activeOption,-1);s.length&&this.setActiveOption(s,!0,!0)}return void t.preventDefault();case i.KEY_RETURN:return void(this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),t.preventDefault()));case i.KEY_LEFT:return void this.advanceSelection(-1,t);case i.KEY_RIGHT:return void this.advanceSelection(1,t);case i.KEY_TAB:return this.settings.selectOnTab&&this.isOpen&&this.$activeOption&&(this.onOptionSelect({currentTarget:this.$activeOption}),this.isFull()||t.preventDefault()),void(this.settings.create&&this.createItem()&&t.preventDefault());case i.KEY_BACKSPACE:case i.KEY_DELETE:return void this.deleteSelection(t)}!this.isFull()&&!this.isInputHidden||(i.IS_MAC?t.metaKey:t.ctrlKey)||t.preventDefault()}},onKeyUp:function(t){if(this.isLocked)return t&&t.preventDefault();var e=this.$control_input.val()||"";this.lastValue!==e&&(this.lastValue=e,this.onSearchChange(e),this.refreshOptions(),this.trigger("type",e))},onSearchChange:function(t){var e=this,i=e.settings.load;i&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(s){i.apply(e,[t,s])})))},onFocus:function(t){var e=this.isFocused;if(this.isDisabled)return this.blur(),t&&t.preventDefault(),!1;this.ignoreFocus||(this.isFocused=!0,"focus"===this.settings.preload&&this.onSearchChange(""),e||this.trigger("focus"),this.$activeItems.length||(this.showInput(),this.setActiveItem(null),this.refreshOptions(!!this.settings.openOnFocus)),this.refreshState())},onBlur:function(t,e){var i=this;if(i.isFocused&&(i.isFocused=!1,!i.ignoreFocus)){if(!i.ignoreBlur&&document.activeElement===i.$dropdown_content[0])return i.ignoreBlur=!0,void i.onFocus(t);var s=function(){i.close(),i.setTextboxValue(""),i.setActiveItem(null),i.setActiveOption(null),i.setCaret(i.items.length),i.refreshState(),e&&e.focus&&e.focus(),i.isBlurring=!1,i.ignoreFocus=!1,i.trigger("blur")};i.isBlurring=!0,i.ignoreFocus=!0,i.settings.create&&i.settings.createOnBlur?i.createItem(null,!1,s):s()}},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(t){var i,s,n=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),(s=e(t.currentTarget)).hasClass("create")?n.createItem(null,function(){n.settings.closeAfterSelect&&n.close()}):void 0!==(i=s.attr("data-value"))&&(n.lastQuery=null,n.setTextboxValue(""),n.addItem(i),n.settings.closeAfterSelect?n.close():!n.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&n.setActiveOption(n.getOption(i)))},onItemSelect:function(t){this.isLocked||"multi"===this.settings.mode&&(t.preventDefault(),this.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,i=e.$wrapper.addClass(e.settings.loadingClass);e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||i.removeClass(e.settings.loadingClass),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input,i=e.val()!==t;i&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return this.tagType===i.TAG_SELECT&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t,e){var i=e?[]:["change"];s.debounce_events(this,i,function(){this.clear(e),this.addItems(t,e)})},setActiveItem:function(t,i){var s,n,o,r,a,l,h,p;if("single"!==this.settings.mode){if(!(t=e(t)).length)return e(this.$activeItems).removeClass("active"),this.$activeItems=[],void(this.isFocused&&this.showInput());if("mousedown"===(s=i&&i.type.toLowerCase())&&this.isShiftDown&&this.$activeItems.length){for(p=this.$control.children(".active:last"),r=Array.prototype.indexOf.apply(this.$control[0].childNodes,[p[0]]),a=Array.prototype.indexOf.apply(this.$control[0].childNodes,[t[0]]),r>a&&(h=r,r=a,a=h),n=r;n<=a;n++)l=this.$control[0].childNodes[n],-1===this.$activeItems.indexOf(l)&&(e(l).addClass("active"),this.$activeItems.push(l));i.preventDefault()}else"mousedown"===s&&this.isCtrlDown||"keydown"===s&&this.isShiftDown?t.hasClass("active")?(o=this.$activeItems.indexOf(t[0]),this.$activeItems.splice(o,1),t.removeClass("active")):this.$activeItems.push(t.addClass("active")[0]):(e(this.$activeItems).removeClass("active"),this.$activeItems=[t.addClass("active")[0]]);this.hideInput(),this.isFocused||this.focus()}},setActiveOption:function(t,i,n){var o,r,a,l,h;this.$activeOption&&this.$activeOption.removeClass("active"),this.$activeOption=null,(t=e(t)).length&&(this.$activeOption=t.addClass("active"),!i&&s.isset(i)||(o=this.$dropdown_content.height(),r=this.$activeOption.outerHeight(!0),i=this.$dropdown_content.scrollTop()||0,a=this.$activeOption.offset().top-this.$dropdown_content.offset().top+i,l=a,h=a-o+r,a+r>o+i?this.$dropdown_content.stop().animate({scrollTop:h},n?this.settings.scrollDuration:0):a<i&&this.$dropdown_content.stop().animate({scrollTop:l},n?this.settings.scrollDuration:0)))},selectAll:function(){"single"!==this.settings.mode&&(this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.$activeItems.length&&(this.hideInput(),this.close()),this.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(t){this.$control_input[0].blur(),this.onBlur(null,t)},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e=[{field:e}]),{fields:t.searchField,conjunction:t.searchConjunction,sort:e,nesting:t.nesting}},search:function(t){var i,n,o,r=this.settings,a=this.getSearchOptions();if(r.score&&"function"!=typeof(o=this.settings.score.apply(this,[t])))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==this.lastQuery?(this.lastQuery=t,n=this.sifter.search(t,e.extend(a,{score:o})),this.currentResults=n):n=e.extend(!0,{},this.currentResults),r.hideSelected)for(i=n.items.length-1;i>=0;i--)-1!==this.items.indexOf(s.hash_key(n.items[i].id))&&n.items.splice(i,1);return n},refreshOptions:function(t){var i,n,o,r,l,h,p,u,c,d,g,f,v,m,y,w;void 0===t&&(t=!0);var C=this,O=e.trim(C.$control_input.val()),_=C.search(O),$=C.$dropdown_content,b=C.$activeOption&&s.hash_key(C.$activeOption.attr("data-value"));for(r=_.items.length,"number"==typeof C.settings.maxOptions&&(r=Math.min(r,C.settings.maxOptions)),l={},h=[],i=0;i<r;i++)for(p=C.options[_.items[i].id],u=C.render("option",p),c=p[C.settings.optgroupField]||"",d=e.isArray(c)?c:[c],n=0,o=d&&d.length;n<o;n++)c=d[n],C.optgroups.hasOwnProperty(c)||(c=""),l.hasOwnProperty(c)||(l[c]=document.createDocumentFragment(),h.push(c)),l[c].appendChild(u);for(this.settings.lockOptgroupOrder&&h.sort(function(t,e){var i=C.optgroups[t].$order||0,s=C.optgroups[e].$order||0;return i-s}),g=document.createDocumentFragment(),i=0,r=h.length;i<r;i++)c=h[i],C.optgroups.hasOwnProperty(c)&&l[c].childNodes.length?((f=document.createDocumentFragment()).appendChild(C.render("optgroup_header",C.optgroups[c])),f.appendChild(l[c]),g.appendChild(C.render("optgroup",e.extend({},C.optgroups[c],{html:s.domToString(f),dom:f})))):g.appendChild(l[c]);if($.html(g),C.settings.highlight&&($.removeHighlight(),_.query.length&&_.tokens.length))for(i=0,r=_.tokens.length;i<r;i++)a($,_.tokens[i].regex);if(!C.settings.hideSelected)for(i=0,r=C.items.length;i<r;i++)C.getOption(C.items[i]).addClass("selected");(v=C.canCreate(O))&&($.prepend(C.render("option_create",{input:O})),w=e($[0].childNodes[0])),C.hasOptions=_.items.length>0||v,C.hasOptions?(_.items.length>0?((y=b&&C.getOption(b))&&y.length?m=y:"single"===C.settings.mode&&C.items.length&&(m=C.getOption(C.items[0])),m&&m.length||(m=w&&!C.settings.addPrecedence?C.getAdjacentOption(w,1):$.find("[data-selectable]:first"))):m=w,C.setActiveOption(m),t&&!C.isOpen&&C.open()):(C.setActiveOption(null),t&&C.isOpen&&C.close())},addOption:function(t){var i,s,n;if(e.isArray(t))for(i=0,s=t.length;i<s;i++)this.addOption(t[i]);else(n=this.registerOption(t))&&(this.userOptions[n]=!0,this.lastQuery=null,this.trigger("option_add",n,t))},registerOption:function(t){var e=s.hash_key(t[this.settings.valueField]);return void 0!==e&&null!==e&&!this.options.hasOwnProperty(e)&&(t.$order=t.$order||++this.order,this.options[e]=t,e)},registerOptionGroup:function(t){var e=s.hash_key(t[this.settings.optgroupValueField]);return!!e&&(t.$order=t.$order||++this.order,this.optgroups[e]=t,e)},addOptionGroup:function(t,e){e[this.settings.optgroupValueField]=t,(t=this.registerOptionGroup(e))&&this.trigger("optgroup_add",t,e)},removeOptionGroup:function(t){this.optgroups.hasOwnProperty(t)&&(delete this.optgroups[t],this.renderCache={},this.trigger("optgroup_remove",t))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,i){var n,o,r,a,l,h,p;if(t=s.hash_key(t),r=s.hash_key(i[this.settings.valueField]),null!==t&&this.options.hasOwnProperty(t)){if("string"!=typeof r)throw new Error("Value must be set in option data");p=this.options[t].$order,r!==t&&(delete this.options[t],-1!==(a=this.items.indexOf(t))&&this.items.splice(a,1,r)),i.$order=i.$order||p,this.options[r]=i,l=this.renderCache.item,h=this.renderCache.option,l&&(delete l[t],delete l[r]),h&&(delete h[t],delete h[r]),-1!==this.items.indexOf(r)&&(n=this.getItem(t),o=e(this.render("item",i)),n.hasClass("active")&&o.addClass("active"),n.replaceWith(o)),this.lastQuery=null,this.isOpen&&this.refreshOptions(!1)}},removeOption:function(t,e){t=s.hash_key(t);var i=this.renderCache.item,n=this.renderCache.option;i&&delete i[t],n&&delete n[t],delete this.userOptions[t],delete this.options[t],this.lastQuery=null,this.trigger("option_remove",t),this.removeItem(t,e)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={};var i=t.options;e.each(t.options,function(e,s){-1==t.items.indexOf(e)&&delete i[e]}),t.options=t.sifter.items=i,t.lastQuery=null,t.trigger("option_clear")},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,i){var s=this.$dropdown.find("[data-selectable]"),n=s.index(t)+i;return n>=0&&n<s.length?s.eq(n):e()},getElementWithValue:function(t,i){if(void 0!==(t=s.hash_key(t))&&null!==t)for(var n=0,o=i.length;n<o;n++)if(i[n].getAttribute("data-value")===t)return e(i[n]);return e()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(t,i){this.buffer=document.createDocumentFragment();for(var s=this.$control[0].childNodes,n=0;n<s.length;n++)this.buffer.appendChild(s[n]);for(var o=e.isArray(t)?t:[t],n=0,r=o.length;n<r;n++)this.isPending=n<r-1,this.addItem(o[n],i);var a=this.$control[0];a.insertBefore(this.buffer,a.firstChild),this.buffer=null},addItem:function(t,i){var n=i?[]:["change"];s.debounce_events(this,n,function(){var n,o,r,a,l,h=this.settings.mode;t=s.hash_key(t),-1===this.items.indexOf(t)?this.options.hasOwnProperty(t)&&("single"===h&&this.clear(i),"multi"===h&&this.isFull()||(n=e(this.render("item",this.options[t])),l=this.isFull(),this.items.splice(this.caretPos,0,t),this.insertAtCaret(n),(!this.isPending||!l&&this.isFull())&&this.refreshState(),this.isSetup&&(r=this.$dropdown_content.find("[data-selectable]"),this.isPending||(o=this.getOption(t),a=this.getAdjacentOption(o,1).attr("data-value"),this.refreshOptions(this.isFocused&&"single"!==h),a&&this.setActiveOption(this.getOption(a))),!r.length||this.isFull()?this.close():this.isPending||this.positionDropdown(),this.updatePlaceholder(),this.trigger("item_add",t,n),this.isPending||this.updateOriginalInput({silent:i})))):"single"===h&&this.close()})},removeItem:function(t,i){var n,o,r;n=t instanceof e?t:this.getItem(t),t=s.hash_key(n.attr("data-value")),-1!==(o=this.items.indexOf(t))&&(n.remove(),n.hasClass("active")&&(r=this.$activeItems.indexOf(n[0]),this.$activeItems.splice(r,1)),this.items.splice(o,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(t)&&this.removeOption(t,i),o<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshState(),this.updatePlaceholder(),this.updateOriginalInput({silent:i}),this.positionDropdown(),this.trigger("item_remove",t,n))},createItem:function(t,i){var n=this,o=n.caretPos;t=t||e.trim(n.$control_input.val()||"");var r=arguments[arguments.length-1];if("function"!=typeof r&&(r=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(t))return r(),!1;n.lock();var a="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},l=s.once(function(t){if(n.unlock(),!t||"object"!=typeof t)return r();var e=s.hash_key(t[n.settings.valueField]);if("string"!=typeof e)return r();n.setTextboxValue(""),n.addOption(t),n.setCaret(o),n.addItem(e),n.refreshOptions(i&&"single"!==n.settings.mode),r(t)}),h=a.apply(this,[t,l]);return void 0!==h&&l(h),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var t=!this.items.length;this.isInvalid=t,this.$control_input.prop("required",t),this.$input.prop("required",!t)},refreshClasses:function(){var t=this.isFull(),i=this.isLocked;this.$wrapper.toggleClass("rtl",this.rtl),this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("required",this.isRequired).toggleClass("invalid",this.isInvalid).toggleClass("locked",i).toggleClass("full",t).toggleClass("not-full",!t).toggleClass("input-active",this.isFocused&&!this.isInputHidden).toggleClass("dropdown-active",this.isOpen).toggleClass("has-options",!e.isEmptyObject(this.options)).toggleClass("has-items",this.items.length>0),this.$control_input.data("grow",!t&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(t){var e,n,o,r;if(t=t||{},this.tagType===i.TAG_SELECT){for(o=[],e=0,n=this.items.length;e<n;e++)r=this.options[this.items[e]][this.settings.labelField]||"",o.push('<option value="'+s.escape_html(this.items[e])+'" selected="selected">'+s.escape_html(r)+"</option>");o.length||this.$input.attr("multiple")||o.push('<option value="" selected="selected"></option>'),this.$input.html(o.join(""))}else this.$input.val(this.getValue()),this.$input.attr("value",this.$input.val());this.isSetup&&(t.silent||this.trigger("change",this.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(),this.isOpen=!0,this.refreshState(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){var t=this.isOpen;"single"===this.settings.mode&&this.items.length&&(this.hideInput(),this.isBlurring||this.$control_input.blur()),this.isOpen=!1,this.$dropdown.hide(),this.setActiveOption(null),this.refreshState(),t&&this.trigger("dropdown_close",this.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t[0].getBoundingClientRect().width,top:e.top,left:e.left})},clear:function(t){this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.lastQuery=null,this.setCaret(0),this.setActiveItem(null),this.updatePlaceholder(),this.updateOriginalInput({silent:t}),this.refreshState(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(t){var e=Math.min(this.caretPos,this.items.length),i=t[0],s=this.buffer||this.$control[0];0===e?s.insertBefore(i,s.firstChild):s.insertBefore(i,s.childNodes[e]),this.setCaret(e+1)},deleteSelection:function(t){var n,o,r,a,l,h,p,u,c;if(r=t&&t.keyCode===i.KEY_BACKSPACE?-1:1,a=s.getSelection(this.$control_input[0]),this.$activeOption&&!this.settings.hideSelected&&(p=this.getAdjacentOption(this.$activeOption,-1).attr("data-value")),l=[],this.$activeItems.length){for(c=this.$control.children(".active:"+(r>0?"last":"first")),h=this.$control.children(":not(input)").index(c),r>0&&h++,n=0,o=this.$activeItems.length;n<o;n++)l.push(e(this.$activeItems[n]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(r<0&&0===a.start&&0===a.length?l.push(this.items[this.caretPos-1]):r>0&&a.start===this.$control_input.val().length&&l.push(this.items[this.caretPos]));if(!l.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete.apply(this,[l]))return!1;for(void 0!==h&&this.setCaret(h);l.length;)this.removeItem(l.pop());return this.showInput(),this.positionDropdown(),this.refreshOptions(!0),p&&(u=this.getOption(p)).length&&this.setActiveOption(u),!0},advanceSelection:function(t,e){var i,n,o,r,a;0!==t&&(this.rtl&&(t*=-1),i=t>0?"last":"first",n=s.getSelection(this.$control_input[0]),this.isFocused&&!this.isInputHidden?(r=this.$control_input.val().length,(t<0?0===n.start&&0===n.length:n.start===r)&&!r&&this.advanceCaret(t,e)):(a=this.$control.children(".active:"+i)).length&&(o=this.$control.children(":not(input)").index(a),this.setActiveItem(null),this.setCaret(t>0?o+1:o)))},advanceCaret:function(t,e){var i,s;0!==t&&(i=t>0?"next":"prev",this.isShiftDown?(s=this.$control_input[i]()).length&&(this.hideInput(),this.setActiveItem(s),e&&e.preventDefault()):this.setCaret(this.caretPos+t))},setCaret:function(t){var i,s,n,o;if(t="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,t)),!this.isPending)for(n=this.$control.children(":not(input)"),i=0,s=n.length;i<s;i++)o=e(n[i]).detach(),i<t?this.$control_input.before(o):this.$control.append(o);this.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){this.$input.prop("disabled",!1),this.$control_input.prop("disabled",!1).prop("tabindex",this.tabIndex),this.isDisabled=!1,this.unlock()},destroy:function(){var t=this.eventNS,i=this.revertSettings;this.trigger("destroy"),this.off(),this.$wrapper.remove(),this.$dropdown.remove(),this.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),this.$control_input.removeData("grow"),this.$input.removeData("selectize"),0==--l.count&&l.$testInput&&(l.$testInput.remove(),l.$testInput=void 0),e(window).off(t),e(document).off(t),e(document.body).off(t),delete this.$input[0].selectize},render:function(t,i){var n,o,r="",a=!1;return"option"!==t&&"item"!==t||(n=s.hash_key(i[this.settings.valueField]),a=!!n),a&&(s.isset(this.renderCache[t])||(this.renderCache[t]={}),this.renderCache[t].hasOwnProperty(n))?this.renderCache[t][n]:(r=e(this.settings.render[t].apply(this,[i,s.escape_html])),"option"===t||"option_create"===t?i[this.settings.disabledField]||r.attr("data-selectable",""):"optgroup"===t&&(o=i[this.settings.optgroupValueField]||"",r.attr("data-group",o),i[this.settings.disabledField]&&r.attr("data-disabled","")),"option"!==t&&"item"!==t||r.attr("data-value",n||""),a&&(this.renderCache[t][n]=r[0]),r[0])},clearCache:function(t){void 0===t?this.renderCache={}:delete this.renderCache[t]},canCreate:function(t){if(!this.settings.create)return!1;var e=this.settings.createFilter;return t.length&&("function"!=typeof e||e.apply(this,[t]))&&("string"!=typeof e||new RegExp(e).test(t))&&(!(e instanceof RegExp)||e.test(t))}}),t.attach("intg.Selectize",l)}),t("skylark-selectize/defaults",["./Selectize"],function(t){t.count=0,t.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}}}),t("skylark-selectize/selectize.jquery",["skylark-jquery","./Selectize","./constants","./defaults","./utils"],function(t,e,i,s,n){return t.fn.selectize=function(i){var s=t.fn.selectize.defaults,o=t.extend({},s,i),r=o.dataAttr,a=o.labelField,l=o.valueField,h=o.disabledField,p=o.optgroupField,u=o.optgroupLabelField,c=o.optgroupValueField;return this.each(function(){if(!this.selectize){var d=t(this),g=this.tagName.toLowerCase(),f=d.attr("placeholder")||d.attr("data-placeholder");f||o.allowEmptyOption||(f=d.children('option[value=""]').text());var v={placeholder:f,options:[],optgroups:[],items:[]};"select"===g?function(e,i){var s,d,g,f,v=i.options,m={},y=function(t){var e=r&&t.attr(r);return"string"==typeof e&&e.length?JSON.parse(e):null},w=function(e,s){e=t(e);var r=n.hash_key(e.val());if(r||o.allowEmptyOption)if(m.hasOwnProperty(r)){if(s){var u=m[r][p];u?t.isArray(u)?u.push(s):m[r][p]=[u,s]:m[r][p]=s}}else{var c=y(e)||{};c[a]=c[a]||e.text(),c[l]=c[l]||r,c[h]=c[h]||e.prop("disabled"),c[p]=c[p]||s,m[r]=c,v.push(c),e.is(":selected")&&i.items.push(r)}},C=function(e){var s,n,o,r,a;for(e=t(e),(o=e.attr("label"))&&((r=y(e)||{})[u]=o,r[c]=o,r[h]=e.prop("disabled"),i.optgroups.push(r)),a=t("option",e),s=0,n=a.length;s<n;s++)w(a[s],o)};for(i.maxItems=e.attr("multiple")?null:1,f=e.children(),s=0,d=f.length;s<d;s++)"optgroup"===(g=f[s].tagName.toLowerCase())?C(f[s]):"option"===g&&w(f[s])}(d,v):function(e,i){var s,n,h,p,u=e.attr(r);if(u)for(i.options=JSON.parse(u),s=0,n=i.options.length;s<n;s++)i.items.push(i.options[s][l]);else{var c=t.trim(e.val()||"");if(!o.allowEmptyOption&&!c.length)return;for(h=c.split(o.delimiter),s=0,n=h.length;s<n;s++)(p={})[a]=h[s],p[l]=h[s],i.options.push(p);i.items=h}}(d,v),new e(d,t.extend(!0,{},s,v,i))}})},t.fn.selectize.defaults=e.defaults,t.fn.selectize.support={validity:i.SUPPORTS_VALIDITY_API},t}),t("skylark-selectize/plugins/drag_drop/plugin",["skylark-jquery","../../Selectize"],function(t,e){e.define("drag_drop",function(e){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var i,s=this;s.lock=(i=s.lock,function(){var t=s.$control.data("sortable");return t&&t.disable(),i.apply(s,arguments)}),s.unlock=function(){var t=s.unlock;return function(){var e=s.$control.data("sortable");return e&&e.enable(),t.apply(s,arguments)}}(),s.setup=function(){var e=s.setup;return function(){e.apply(this,arguments);var i=s.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:s.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var e=s.$activeItems?s.$activeItems.slice():null,n=[];i.children("[data-value]").each(function(){n.push(t(this).attr("data-value"))}),s.setValue(n),s.setActiveItem(e)}})}}()}})}),t("skylark-selectize/plugins/dropdown_header/plugin",["skylark-jquery","../../Selectize"],function(t,e){e.define("dropdown_header",function(e){var i,s=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),s.setup=(i=s.setup,function(){i.apply(s,arguments),s.$dropdown_header=t(e.html(e)),s.$dropdown.prepend(s.$dropdown_header)})})}),t("skylark-selectize/plugins/optgroup_columns/plugin",["skylark-jquery","../../Selectize","../../constants","../../utils"],function(t,e,i,s){e.define("optgroup_columns",function(e){var n,o=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,i){var s=e.closest("[data-group]").find("[data-selectable]"),n=s.index(e)+i;return n>=0&&n<s.length?s.eq(n):t()},this.onKeyDown=(n=o.onKeyDown,function(t){var e,s,r,a;return!this.isOpen||t.keyCode!==i.KEY_LEFT&&t.keyCode!==i.KEY_RIGHT?n.apply(this,arguments):(o.ignoreHover=!0,a=this.$activeOption.closest("[data-group]"),e=a.find("[data-selectable]").index(this.$activeOption),a=t.keyCode===KEY_LEFT?a.prev("[data-group]"):a.next("[data-group]"),r=a.find("[data-selectable]"),void((s=r.eq(Math.min(r.length-1,e))).length&&this.setActiveOption(s)))});var r=function(){var t,e=r.width,i=document;return void 0===e&&((t=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',t=t.firstChild,i.body.appendChild(t),e=r.width=t.offsetWidth-t.clientWidth,i.body.removeChild(t)),e},a=function(){var i,s,n,a,l,h,p;if(p=t("[data-group]",o.$dropdown_content),(s=p.length)&&o.$dropdown_content.width()){if(e.equalizeHeight){for(n=0,i=0;i<s;i++)n=Math.max(n,p.eq(i).height());p.css({height:n})}e.equalizeWidth&&(h=o.$dropdown_content.innerWidth()-r(),a=Math.round(h/s),p.css({width:a}),s>1&&(l=h-a*(s-1),p.eq(s-1).css({width:l})))}};(e.equalizeHeight||e.equalizeWidth)&&(s.hook.after(this,"positionDropdown",a),s.hook.after(this,"refreshOptions",a))})}),t("skylark-selectize/plugins/remove_button/plugin",["../../Selectize","../../utils"],function(t,e){t.define("remove_button",function(t){t=$.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);"single"!==this.settings.mode?function(t,i){var s=t,n='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+e.escape_html(i.title)+'">'+i.label+"</a>";t.setup=(o=s.setup,function(){if(i.append){var e=s.settings.render.item;s.settings.render.item=function(i){return s=e.apply(t,arguments),o=n,r=s.search(/(<\/[^>]+>\s*)$/),s.substring(0,r)+o+s.substring(r);var s,o,r}}o.apply(t,arguments),t.$control.on("click","."+i.className,function(t){if(t.preventDefault(),!s.isLocked){var e=$(t.currentTarget).parent();s.setActiveItem(e),s.deleteSelection()&&s.setCaret(s.items.length)}})});var o}(this,t):function(t,i){i.className="remove-single";var s=t,n='<a href="javascript:void(0)" class="'+i.className+'" tabindex="-1" title="'+e.escape_html(i.title)+'">'+i.label+"</a>";t.setup=(o=s.setup,function(){if(i.append){var e=$(s.$input.context).attr("id"),r=($("#"+e),s.settings.render.item);s.settings.render.item=function(e){return i=r.apply(t,arguments),s=n,$("<span>").append(i).append(s);var i,s}}o.apply(t,arguments),t.$control.on("click","."+i.className,function(t){t.preventDefault(),s.isLocked||s.clear()})});var o}(this,t)})}),t("skylark-selectize/plugins/restore_on_backspace/plugin",["skylark-jquery","../../Selectize"],function(t,e){e.define("restore_on_backspace",function(t){var e,i=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=(e=i.onKeyDown,function(i){var s,n;return i.keyCode===KEY_BACKSPACE&&""===this.$control_input.val()&&!this.$activeItems.length&&(s=this.caretPos-1)>=0&&s<this.items.length?(n=this.options[this.items[s]],this.deleteSelection(i)&&(this.setTextboxValue(t.text.apply(this,[n])),this.refreshOptions(!0)),void i.preventDefault()):e.apply(this,arguments)})})}),t("skylark-selectize/main",["./Selectize","./selectize.jquery","./plugins/drag_drop/plugin","./plugins/dropdown_header/plugin","./plugins/optgroup_columns/plugin","./plugins/remove_button/plugin","./plugins/restore_on_backspace/plugin"],function(t){return t}),t("skylark-selectize",["skylark-selectize/main"],function(t){return t})}(i),!s){var r=require("skylark-langx-ns");n?module.exports=r:e.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-selectize.js.map
